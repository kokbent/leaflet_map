---
title: "Oyster Restoration Project Sensor Map"
output:
  html_document:
    fig_width: 10
    fig_height: 7.5
---

```{r r_packages, include=FALSE}
library("leaflet")
```

These data are provisional raw downloads from instruments and subject to revision following QA/QC procedures.  
This display is just for demonstration purposes. River discharge data are measured at USGS gauge 02323500 (Wilcox) Florida as mean daily discharge in cubic feet per second (by convention).  
Temperature and salinity (estimated from conductivity measures) are recorded hourly using CT sensors at stations 2 and 4-9, and CTD sensors at stations 1 and 3.  
FYI, this map is constantly being updated and changed. Gaps in data are caused by either sensor malfunctions or missing sensors.  
For best graphical results, please click on each oyster distribution layer in the order from least current to most current year. 
- Mel M


```{r r_uploads,include= FALSE}
library("rgdal")

propreef <- readOGR(dsn=path.expand("C:/Users/melimore86/Desktop/Mapping"), layer = "LC_reef_elements")

oysterbeds1982<- readOGR(dsn= path.expand("C:/Users/melimore86/Desktop/Mapping"), layer="LC_1982")

oysterbeds1995<- readOGR(dsn= path.expand("C:/Users/melimore86/Desktop/Mapping"), layer="LC_1995")

oysterbeds2001<- readOGR(dsn= path.expand("C:/Users/melimore86/Desktop/Mapping"), layer="LC_2001")

oysterbeds2010<- readOGR(dsn= path.expand("C:/Users/melimore86/Desktop/Mapping"), layer="LC_2010")

PRO <- sp::CRS('+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0')
oysterbeds1982p <- sp::spTransform(oysterbeds1982,PRO)
oysterbeds1995p <- sp::spTransform(oysterbeds1995,PRO)
oysterbeds2001p <- sp::spTransform(oysterbeds2001,PRO)
oysterbeds2010p <- sp::spTransform(oysterbeds2010,PRO)


```
```{r oyster_icon, include=FALSE}
oystericon <- makeIcon(
  iconUrl = "C:/Users/melimore86/Desktop/oyster.png",
  iconWidth = 25, iconHeight = 40)
```




```{r r_FWC, include= FALSE}
require(sas7bdat)
setwd("C:/Users/melimore86/Desktop/FWC")

hydro2017=read.sas7bdat("ckm_2017_hydrolab.sas7bdat")
physical2017=read.sas7bdat("ckm_2017_physical.sas7bdat")

require(dplyr)
hydrophysical2017 <- left_join(hydro2017, physical2017, by = c('Reference'))

require(reshape)
hydrophysical2017$Reference2 <- substr(hydrophysical2017$Reference, start=4, stop=11)

require(lubridate)
hydrophysical2017$NEWDATE <- lubridate::ymd(hydrophysical2017$Reference2)

lon<-(physical2017$Longitude)
lat<-(physical2017$Latitude)
dffwc2017 <- as.data.frame(cbind(lon,lat))

```

```{r r_map, include=FALSE}
intermap<-leaflet() %>% addProviderTiles("CartoDB.Positron",group = "CartoDB Positron")%>% addProviderTiles("OpenStreetMap", group = "OpenStreetMap") %>%  addProviderTiles("Esri.WorldImagery", group = "Esri WorldImagery")  %>% 
  addProviderTiles("OpenTopoMap", group = "OpenTopoMap") %>%  
  addPolygons(data = oysterbeds1982p,stroke = FALSE, fillOpacity = .8, smoothFactor = 0.5, group= "1982 oyster distribution", color= "#33FF00")%>%
  addPolygons(data = oysterbeds1995p,stroke = FALSE, fillOpacity = 0.8, smoothFactor = 0.5, group= "1995 oyster distribution", color= "#3399FF")%>%
  addPolygons(data = oysterbeds2001p,stroke = FALSE, fillOpacity = 0.6, smoothFactor = 0.5, group= "2001 oyster distribution", color= "#9900FF")%>%
   addPolygons(data = oysterbeds2010p,stroke = FALSE, fillOpacity = 0.6, smoothFactor = 0.5, group= "2010 oyster distribution", color= "#FF33CC")%>%
   addPolygons(data = propreef,stroke = FALSE, fillOpacity = 1, smoothFactor = 0.5, group= "Proposed Reef", color="black")%>%
  addCircleMarkers(data=physical2017,lng=lon,lat=lat,label = ~as.character(Station_1), group="FWC 2017 Sites",color="#009E73")%>%#addCircleMarkers(data=hydrophysical,lng=lon,lat=lat,label = ~as.character(Station_1), group="All FWS Sites (all years, tbd)", color="#E69F00")%>%
  setView(-83.10, 29.25, 14) %>%#addGraticule(interval = 0.01, style = list(color = "#FF0000", weight = 1, group= "Graticule"))%>%
addMarkers(
    lng = -83.115630028769374, lat = 29.266499960795045,
    label = "Site 1",
    labelOptions = labelOptions(noHide = F),
    popup= '<a href = "http://rpubs.com/melimore86/site1measurements"> Sensor Measurements </a>',icon=oystericon) %>%
  addMarkers(
    lng = -83.095889976248145, lat = 29.245640002191067,
    label = "Site 2",
    labelOptions = labelOptions(noHide = F),
    popup= '<a href = "http://rpubs.com/melimore86/site2measurements"> Sensor Measurements </a>',icon=oystericon) %>%
  addMarkers(
    lng = -83.090120041742921, lat = 29.231049958616495,
    label = "Site 3",
    labelOptions = labelOptions(noHide = F),
    popup= '<a href = "http://rpubs.com/melimore86/site3measurements"> Sensor Measurements </a>',icon=oystericon) %>%
  addMarkers(
    lng = -83.092115018516779, lat = 29.230171032249928,
    label = "Site 4",
    labelOptions = labelOptions(noHide = F),
    popup= '<a href = "http://rpubs.com/melimore86/site4measurements"> Sensor Measurements </a>',icon=oystericon) %>%
  addMarkers(
    lng = -83.10149998404085, lat = 29.246092038229108,
    label = "Site 5",
    labelOptions = labelOptions(noHide = F),
    popup= '<a href = "http://rpubs.com/melimore86/site5measurements"> Sensor Measurements </a>',icon=oystericon) %>%
  addMarkers(
    lng = -83.118119034916162, lat = 29.265770986676216,
    label = "Site 6",
    labelOptions = labelOptions(noHide = F),
    popup= '<a href = "http://rpubs.com/melimore86/site6measurements"> Sensor Measurements </a>',icon=oystericon)%>%
  addMarkers(
    lng = -83.09822, lat = 29.26773,
    label = "Site 7",
    labelOptions = labelOptions(noHide = F),
    popup= '<a href = "http://rpubs.com/melimore86/site7measurements"> Sensor Measurements </a>',icon=oystericon) %>%
  addMarkers(
    lng = -83.08027, lat = 29.25743,
    label = "Site 8",
    labelOptions = labelOptions(noHide = F),
    popup= '<a href = "http://rpubs.com/melimore86/site8measurements"> Sensor Measurements </a>',icon=oystericon) %>%
  addMarkers(
    lng = -83.08271, lat = 29.23215,
    label = "Site 9",
    labelOptions = labelOptions(noHide = F),
    popup= '<a href = "http://rpubs.com/melimore86/site9measurements"> Sensor Measurements </a>',icon=oystericon) %>%
  addProviderTiles("OpenWeatherMap.Clouds", group = "clouds2", options = tileOptions(opacity = 0.6)) %>%
  addTiles(urlTemplate = "http://{s}.tile.openweathermap.org/map/temp/{z}/{x}/{y}.png", attribution = "Weather data © OpenWeatherMap", group = "temp", options = tileOptions(opacity = 0.6)) %>% 
  addTiles(urlTemplate = "http://{s}.tile.openweathermap.org/map/precipitation/{z}/{x}/{y}.png", attribution = "Weather data © OpenWeatherMap", group = "precipitation", 
           options = tileOptions(opacity = 0.6)) %>% addTiles(urlTemplate = "http://{s}.tile.openweathermap.org/map/snow/{z}/{x}/{y}.png", attribution = "Weather data © OpenWeatherMap", group = "snow", options = tileOptions(opacity = 0.6)) %>% 
  addTiles(urlTemplate = "http://{s}.tile.openweathermap.org/map/wind/{z}/{x}/{y}.png", 
           attribution = "Weather data © OpenWeatherMap", group = "wind", 
           options = tileOptions(opacity = 0.6)) %>% 
  addLayersControl(baseGroups = c("CartoDB Positron","OpenTopoMap","OpenStreetMap", 
                                  "Esri WorldImagery", "none"), overlayGroups = c("1982 oyster distribution","1995 oyster distribution","2001 oyster distribution","2010 oyster distribution","Proposed Reef","FWC 2017 Sites"), options = layersControlOptions(collapsed = TRUE)) %>% 
  hideGroup(c("2010 oyster distribution","2001 oyster distribution","1995 oyster distribution","1982 oyster distribution","FWC 2017 Sites","Proposed Reef"))

```

```{r intermap, echo=FALSE}
intermap
```

